define(["properties","toastr","jquery.spin"],function(e,t){var a=null,n=function(){$("input[name=vlan_mode]").click(function(){"Trunk"==$("input[name=vlan_mode]:checked").val()?($("input[data-id=trunks]").parent().show(),$("input[data-id=tag]").parent().hide()):($("input[data-id=tag]").parent().show(),$("input[data-id=trunks]").parent().hide())})},o=e.rmsIp,d=function(e){$(".spin").spin("hide");var t=e.type;e.error||"failure"==t?"failure"==t?($("div.alert-message-success").hide(),$("div.alert-message-error").show().html(e.message)):($("div.alert-message-success").hide(),$("div.alert-message-error").show().html(e.error.error)):($("div.alert-message-success").show().html("Succesfully Added"),$("div.alert-message-error").hide())},s=function(e){$(".spin").spin("hide"),console.log("Error"),$("div.alert-message-success").hide(),$("div.alert-message-error").show().html(e.responseText)},p=null,r=!1;return{getDom:function(){return a},setDom:function(e){a=e},templateTable:function(){var a=e.templateIp+"listAllTemplates";$.get(a,function(e){for(i=0;i<e.Instances.length;i++){var t=$("<tr>");t.append("<td> <input type='radio' name='instances' value="+e.Instances[i].name+"></input> </td>"),t.append($("<td>").append(e.Instances[i].name)),$("#viewInstance").find("tbody").append(t)}for(i=0;i<e.FS.length;i++){var t=$("<tr>");t.append("<td> <input type='radio' name='fs' value="+e.FS[i].name+"></input> </td>"),t.append($("<td>").append(e.FS[i].name)),$("#viewFanTemplate").find("tbody").append(t)}for(i=0;i<e.OS.length;i++){var t=$("<tr>");t.append("<td> <input type='radio' name='os' value="+e.OS[i].name+"></input> </td>"),t.append($("<td>").append(e.OS[i].name)),$("#viewOsTemplate").find("tbody").append(t)}for(i=0;i<e.PS.length;i++){var t=$("<tr>");t.append("<td> <input type='radio' name='ps' value="+e.PS[i].name+"></input> </td>"),t.append($("<td>").append(e.PS[i].name)),$("#viewPowerSupplyTemplate").find("tbody").append(t)}for(i=0;i<e.Templates.length;i++){var t=$("<tr>");t.append("<td> <input type='radio' name='templates' value="+e.Templates[i].name+"></input> </td>"),t.append($("<td>").append(e.Templates[i].name)),$("#viewFbTemplate").find("tbody").append(t)}for(i=0;i<e.TS.length;i++){var t=$("<tr>");t.append("<td> <input type='radio' name='ts' value="+e.TS[i].name+"></input> </td>"),t.append($("<td>").append(e.TS[i].name)),$("#viewTransceiverTemplate").find("tbody").append(t)}}),$("#assigningTemplates").click(function(){var a=$("g.node-selected").attr("data-id"),n=e.templateIp+"assignTemplates?fb_device_name="+a,o=$('input[name="instances"]:checked').val(),i=$('input[name="fs"]:checked').val(),d=$('input[name="os"]:checked').val(),s=$('input[name="ps"]:checked').val(),p=$('input[name="templates"]:checked').val(),r=$('input[name="ts"]:checked').val(),c={fb_device_name:a,fbFS:i,fbInstance:o,fbOS:d,fbPS:s,fbTS:r,fbTemplate:p};$.ajax({url:n,method:"POST",data:JSON.stringify(c),contentType:"application/json; charset=utf-8",success:function(){t.success("Templates assigned to node successfully")},error:function(){t.error("Could not assign templates")}})})},bridgeTable:function(){var t=$("g.node-selected").attr("data-id"),a=e.rmsIp+t+"/listBridge";$.get(a,function(e){$("#viewBridge");e.forEach(function(e){var t=$("<tr>");t.append($("<td>").append(e.name)),t.append($("<td>").append(e.datapath_type)),t.append($("<td>").append(e.datapath_id)),t.append($("<td>").append(e.protocols)),t.append($("<td>").append(e.fb_ip)),$("#viewBridge").find("tbody").append(t)})})},portTable:function(){var t=$("g.node-selected").attr("data-id"),a=e.rmsIp+t+"/list-ports";$.get(a,function(e){$("#viewPort");e.forEach(function(e){var t=$("<tr>");t.append($("<td>").append(e.name)),t.append($("<td>").append(e.vlan_mode)),t.append($("<td>").append(e.fb_ip)),t.append($("<td>").append(e.type)),t.append($("<td>").append(e.speed)),t.append($("<td>").append(e.is_dac)),$("#viewPort").find("tbody").append(t)})})},savingDetails:function(){var e=$("g.node-selected").attr("data-id");$("#pageModal button.saveBtn").click(function(){var t=$("#pageModal div.tab-content .tab-pane.active").attr("id");switch(t){case"fbConfig":console.log("fbConfig");var a=o+e+"/add-bridge",n=$("#"+t+" #name")[0].value,i=$("#"+t+" #datapath_type")[0].value,p=$("#"+t+" #datapath_id")[0].value,r=$("#"+t+" #protocols")[0].value,c=$("#"+t+" #fb_ip")[0].value,l={name:n,datapath_type:i,datapath_id:p,protocols:r,fb_ip:c};$(".spin").spin(),$(".spin").spin("show"),$.ajax({url:a,method:"POST",data:JSON.stringify(l),contentType:"application/json; charset=utf-8",success:function(e){var t=$("<tr>");t.append($("<td>").append(l.name)),t.append($("<td>").append(l.datapath_type)),t.append($("<td>").append(l.datapath_id)),t.append($("<td>").append(l.protocols)),t.append($("<td>").append(l.fb_ip)),$("#viewBridge").find("tbody").append(t),d(e)},error:function(e){s(e)}});break;case"fbConfigLink":console.log("fbConfigLink");var a=o+e+"/add-bridge",u=$("#"+t+" #link_speed")[0].value,l={link_speed:u};$.ajax({url:a,method:"POST",data:l,contentType:"application/json",success:function(){console.log("Success")},error:function(){console.log("Error")}});break;case"addPort":console.log("addPort");var a=o+e+"/port/add",n=$("#"+t).find('input[data-id="name"]')[0].value,f="access",c=$("#"+t).find('input[data-id="fb_ip"]')[0].value,m=$("#"+t).find('input[data-id="type"]')[0].value,g=$("#"+t).find('input[data-id="speed"]')[0].value,h=$("#"+t).find('input[data-id="tag"]')[0].value,v=$("#"+t).find('input[name="is_dac"]:checked').attr("data-id"),y=!1;"true"==v&&(y=!0);var l=null;l="access"==f.toLowerCase?{fb_ip:c,is_dac:y,name:n,speed:g,tag:parseInt(h),type:m,vlan_mode:f.toLowerCase()}:{fb_ip:c,is_dac:y,name:n,speed:g,trunks:[parseInt(trunks)],type:m,vlan_mode:f.toLowerCase()},$.ajax({url:a,method:"POST",data:JSON.stringify(l),contentType:"application/json; charset=utf-8",success:function(e){var t=$("<tr>");t.append($("<td>").append(l.name)),t.append($("<td>").append(l.vlan_mode)),t.append($("<td>").append(l.fb_ip)),t.append($("<td>").append(l.type)),t.append($("<td>").append(l.speed)),t.append($("<td>").append(l.is_dac)),$("#viewPort").find("tbody").append(t),d(e)},error:function(e){s(e)}});break;case"fbConfigController":console.log("fbConfigController");var a=o+e+"/set-controller",n=$("#"+t+" #name")[0].value,S=$("#"+t+" #controller_ip")[0].value,b=$("#"+t+" #of_port")[0].value,r=$("#"+t+" #protocols")[0].value,c=$("#"+t+" #fb_ip")[0].value,l={name:n,controller_ip:S,of_port:b,connect_protocol:r,fb_ip:c};$.ajax({url:a,method:"POST",data:JSON.stringify(l),contentType:"application/json; charset=utf-8",success:function(){console.log("Success"),$("div.alert-message-success").show()},error:function(){console.log("Error"),$("div.alert-message-error").show()}});break;case"lldpConfigIL":console.log("lldpConfigIL");var a=o+e+"/set-lldp",T=$("#"+t+" #fb_br")[0].value,c=$("#"+t+" #fb_ip")[0].value,k=$("#"+t+" #per_interface_settings")[0].value,l={fb_br:T,fb_ip:c,per_interface_settings:k};$.ajax({url:a,method:"POST",data:JSON.stringify(l),contentType:"application/json; charset=utf-8",success:function(){console.log("Success"),$("div.alert-message-success").show()},error:function(){console.log("Error"),$("div.alert-message-error").show()}});break;case"configArp":console.log("configArp");var a=o+e+"/configure/neighbor-discovery",_=$("#"+t+" #arp_subnet")[0].value,w=$("#"+t+" #nd_subnet")[0].value,l={arp_subnet:_,nd_subnet:w};$.ajax({url:a,method:"POST",data:l,contentType:"application/json",success:function(){console.log("Success")},error:function(){console.log("Error")}});break;case"configTcam":console.log("configTcam");var a=o+e+"/configure/tcam",D=$("#"+t+" #match_mode_name")[0].value,N=$("#"+t+" #priority_low")[0].value,x=$("#"+t+" #priority_high")[0].value,l={match_mode_name:D,priority_low:N,priority_high:x};$.ajax({url:a,method:"POST",data:l,contentType:"application/json",success:function(){console.log("Success")},error:function(){console.log("Error")}})}})},init:function(e){n();var t=e.iconType();"optical-fiber"==t?$("#pageModal .modal-title").html("Configure Optical Switch"):"fb-icon"==t&&$("#pageModal .modal-title").html("Configure Forwarding Box")},initLinkEvents:function(a){var n=(e.createLink,{destination:{"dest-node":a.node().id(),"dest-tp":$("input[name='portselcted']:checked").next().text()},"link-cost":$("#linkcost").val(),"link-group-id":[$("#linkGroupId").val()],"link-id":$("#linkId").val(),"link-validate":$("#linkValid").val(),"max-bandwidth":{unit:"GBPS",value:$("#max-bandwidth").val()},source:{"source-node":this.getSourceNodeDetails().node,"source-tp":this.getSourceNodeDetails().data}});if(!$("#linkId").val())return void t.error("Enter link id");a.topology().addLink({source:this.getSourceNodeDetails().node,target:a.node().id()}),$.ajax({url:e.createLink,type:"post",data:JSON.stringify(n),contentType:"application/json; charset=utf-8",success:function(){t.success("Link is added successfully"),e.addLink($("#linkId").val())}});var i=o+this.getSourceNodeDetails().node+"/"+this.getSourceNodeDetails().data+"/false",p=o+a.node().id()+"/"+$("input[name='portselcted']:checked").next().text()+"/false";if("patch-panel"==this.getSourceNodeDetails().iconType||"optical-switch"==this.getSourceNodeDetails().iconType){var r=e.socket(),c={name:this.getSourceNodeDetails().node,type:this.getSourceNodeDetails().iconType,portname:this.getSourceNodeDetails().data,status:"true"};r.emit("port-status-set",JSON.stringify(c))}else $.ajax({url:i,method:"POST",contentType:"application/json; charset=utf-8",success:function(e){d(e)},error:function(e){s(e)}});if("patch-panel"==a.node().get("iconType")||"optical-switch"==a.node().get("iconType")){var r=e.socket(),c={name:a.node().id(),type:a.node().get("iconType"),portname:$("input[name='portselcted']:checked").next().text(),status:"true"};r.emit("port-status-set",JSON.stringify(c))}else $.ajax({url:p,method:"POST",contentType:"application/json; charset=utf-8",success:function(e){d(e)},error:function(e){s(e)}});this.setSourceSelected(!1),$("#pageModal ").modal("hide")},initFStoOB:function(t){var a=(e.createLink,o+this.getSourceNodeDetails().node+"/"+this.getSourceNodeDetails().data+"/false"),n=o+t.node().id()+"/"+$("input[name='portselcted']:checked").next().text()+"/false",i=e.socket();if(t.topology().addLink({source:this.getSourceNodeDetails().node,target:t.node().id()}),srcData={},"fb-icon"==this.getSourceNodeDetails().iconType?(srcData.name=this.getSourceNodeDetails().node,srcData.link={"l1-switch-port":$("input[name='portselcted']:checked").next().text(),"fb-port":this.getSourceNodeDetails().data}):"fb-icon"==t.node().iconType()&&(srcData.name=t.node().id(),srcData.link={"l1-switch-port":this.getSourceNodeDetails().data,"fb-port":$("input[name='portselcted']:checked").next().text()}),i.emit("fbtooptical",srcData),"patch-panel"==this.getSourceNodeDetails().iconType||"optical-switch"==this.getSourceNodeDetails().iconType){({name:this.getSourceNodeDetails().node,type:this.getSourceNodeDetails().iconType,portname:this.getSourceNodeDetails().data,status:"true"})}else $.ajax({url:a,method:"POST",contentType:"application/json; charset=utf-8",success:function(e){d(e)},error:function(e){s(e)}});if("patch-panel"==t.node().get("iconType")||"optical-switch"==t.node().get("iconType")){var i=e.socket();({name:t.node().id(),type:t.node().get("iconType"),portname:$("input[name='portselcted']:checked").next().text(),status:"true"})}else $.ajax({url:n,method:"POST",contentType:"application/json; charset=utf-8",success:function(e){d(e)},error:function(e){s(e)}});this.setSourceSelected(!1),$("#pageModal ").modal("hide")},setSourceNodeDetails:function(e){var t=this.getDom();t.state.sourceData.sourceName=e.node,t.state.sourceData.sourceType=e.iconType,t.state.sourceData.portData=e.data,t.setState(t.state),r=!0,p=e},isSourceSelected:function(){return r},getSourceNodeDetails:function(){return p},setSourceSelected:function(e){r=e},isValidLink:function(e,t){var a=!1;switch(t){case"patch-panel":"host"==e?a=!0:"fb-icon"==e&&(a=!0);break;case"fb-icon":a=!0;break;case"optical-switch":"fb-icon"==e&&(a=!0);break;case"host":"fb-icon"==e?a=!0:"patch-panel"==e&&(a=!0)}return a}}});